<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHOP MASTER 2.0 - Functional E-commerce</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        .hero-bg { background-image: url('https://placehold.co/1200x500/103a61/ffffff?text=SUMMER+SALE+COLLECTION'); background-size: cover; background-position: center; }
        .cart-badge { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .cart-modal-transition { transition: transform 0.3s ease-out; }
        /* New: Auth Modal Styling */
        .auth-modal-transition { transition: opacity 0.3s, transform 0.3s; }
    </style>
</head>
<body onload="initApp()">
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="#" class="text-2xl font-bold text-gray-900 tracking-wider"> SHOP<span class="text-blue-600">2.0</span> </a>
                <div class="flex items-center space-x-4">
                    <div id="auth-buttons">
                        <button onclick="openAuthModal('login')" class="text-sm font-medium text-gray-600 hover:text-blue-600 transition p-2 rounded-lg hover:bg-gray-100">Log In</button>
                        <button onclick="openAuthModal('register')" class="text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 transition px-3 py-1.5 rounded-lg shadow-md">Register</button>
                    </div>
                    <div id="user-info" class="hidden flex items-center space-x-2">
                        <span id="user-display-email" class="text-sm font-medium text-gray-700"></span>
                        <button onclick="clientLogout()" class="text-sm font-medium text-red-600 hover:text-red-700 transition p-2 rounded-lg hover:bg-red-50">Logout</button>
                    </div>
                    <button onclick="toggleCartModal()" class="text-gray-600 hover:text-blue-600 relative flex items-center space-x-1 p-2 rounded-full hover:bg-gray-100 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                        <span id="cart-count" class="cart-badge absolute top-0 right-0 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center transform scale-0">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <section class="hero-bg h-64 sm:h-96 rounded-xl shadow-lg flex items-center justify-center mb-12 relative overflow-hidden">
            <div class="absolute inset-0 bg-black bg-opacity-40"></div>
            <div class="relative text-center p-4 sm:p-8 text-white z-10">
                <h1 class="text-4xl sm:text-6xl font-extrabold mb-2 drop-shadow-lg"> PREMIUM COLLECTIONS </h1>
                <p class="text-lg sm:text-2xl mb-6 drop-shadow-md">Style, Delivered.</p>
                <a href="#products" class="inline-block px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-semibold transition duration-300"> Shop Now </a>
            </div>
        </section>

        <section id="products" class="mb-12">
            <div class="flex justify-between items-end mb-6 border-b-2 border-gray-100 pb-2">
                <h2 class="text-3xl font-bold text-gray-800">Featured Products</h2>
                <span class="text-sm text-gray-500">Local Data Simulation</span>
            </div>
            <div id="product-showcase" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white mt-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-sm">
            &copy; 2025 SHOP MASTER 2.0. All rights reserved. | Designed with Tailwind CSS & Vanilla JS.
        </div>
    </footer>

    <div id="cart-modal" class="fixed inset-0 z-[60] hidden" aria-labelledby="slide-over-title" role="dialog" aria-modal="true">
        <div id="cart-backdrop" class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity opacity-0" onclick="toggleCartModal()"></div>

        <div class="fixed inset-0 overflow-hidden">
            <div class="absolute inset-0 overflow-hidden">
                <div id="cart-panel" class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10 transform translate-x-full cart-modal-transition">
                    <div class="pointer-events-auto w-screen max-w-md">
                        <div class="flex h-full flex-col overflow-y-scroll bg-white shadow-xl">
                            <div class="flex-1 overflow-y-auto px-4 py-6 sm:px-6">
                                <div class="flex items-start justify-between">
                                    <h2 class="text-xl font-bold text-gray-900" id="slide-over-title">Shopping Cart</h2>
                                    <button type="button" class="relative -m-2 p-2 text-gray-400 hover:text-gray-500" onclick="toggleCartModal()">
                                        <span class="sr-only">Close panel</span>
                                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>

                                <div class="mt-8">
                                    <div class="flow-root">
                                        <ul id="cart-items-container" role="list" class="-my-6 divide-y divide-gray-200">
                                            </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="border-t border-gray-200 px-4 py-6 sm:px-6">
                                <div class="flex justify-between text-base font-medium text-gray-900">
                                    <p>Subtotal</p>
                                    <p id="cart-total">$0.00</p>
                                </div>
                                <p class="mt-0.5 text-sm text-gray-500">Shipping and taxes calculated at checkout.</p>
                                <div class="mt-6">
                                    <button onclick="processCheckout()" class="flex items-center justify-center rounded-md border border-transparent bg-blue-600 px-6 py-3 text-base font-medium text-white shadow-sm hover:bg-blue-700 w-full disabled:bg-gray-400" id="checkout-button"> Checkout </button>
                                </div>
                                <div class="mt-6 flex justify-center text-center text-sm text-gray-500">
                                    <p> or <button type="button" class="font-medium text-blue-600 hover:text-blue-500" onclick="toggleCartModal()"> Continue Shopping <span aria-hidden="true"> &rarr; </span> </button> </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-50 z-[70] hidden flex items-center justify-center backdrop-blur-sm p-4">
        <div id="auth-content" class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 sm:p-8 transform transition-all auth-modal-transition">
            <div class="flex justify-end">
                <button onclick="closeAuthModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <form id="client-login-form" onsubmit="event.preventDefault(); clientLogin()" class="auth-form">
                <h3 class="text-2xl font-bold mb-6 text-gray-800">Welcome Back</h3>
                <div class="space-y-4">
                    <div>
                        <label for="c-login-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input id="c-login-email" type="email" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" placeholder="your@gmail.com">
                    </div>
                    <div>
                        <label for="c-login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input id="c-login-password" type="password" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" placeholder="********">
                    </div>
                    <p id="c-login-error" class="text-red-500 text-sm hidden">Error message</p>
                </div>
                <div class="mt-8">
                    <button type="submit" class="w-full px-6 py-3 rounded-xl bg-blue-600 text-white hover:bg-blue-700 font-medium shadow-lg transition">Log In</button>
                </div>
                <p class="mt-4 text-center text-sm text-gray-600">
                    Need an account? <a href="#" onclick="showClientRegister()" class="text-blue-600 hover:text-blue-500 font-semibold">Register</a>
                </p>
            </form>

            <form id="client-register-form" onsubmit="event.preventDefault(); clientRegister()" class="auth-form hidden">
                <h3 class="text-2xl font-bold mb-6 text-gray-800">Create Account</h3>
                <div class="space-y-4">
                    <div>
                        <label for="c-reg-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input id="c-reg-email" type="email" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" placeholder="your@gmail.com">
                    </div>
                    <div>
                        <label for="c-reg-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input id="c-reg-password" type="password" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" placeholder="8-10 chars, complexity required">
                    </div>
                    <div>
                        <label for="c-reg-phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                        <input id="c-reg-phone" type="text" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g., 1234567890">
                    </div>
                    <p id="c-register-error" class="text-red-500 text-sm hidden">Error message</p>
                </div>
                <div class="mt-8">
                    <button type="submit" class="w-full px-6 py-3 rounded-xl bg-green-600 text-white hover:bg-green-700 font-medium shadow-lg transition">Register</button>
                </div>
                <p class="mt-4 text-center text-sm text-gray-600">
                    Already registered? <a href="#" onclick="showClientLogin()" class="text-blue-600 hover:text-blue-500 font-semibold">Log In</a>
                </p>
            </form>
        </div>
    </div>


    <script>
        // --- DATA SIMULATION ---
        const MOCK_PRODUCTS = [
            { id: 'p001', name: 'Premium Linen Shirt', price: 59.99, image: 'https://placehold.co/400x400/1e293b/ffffff?text=Linen+Shirt', description: 'Lightweight linen for ultimate comfort.' },
            { id: 'p002', name: 'Vintage Leather Belt', price: 34.50, image: 'https://placehold.co/400x400/475569/ffffff?text=Leather+Belt', description: 'Hand-stitched full-grain leather.' },
            { id: 'p003', name: 'Casual Slim Jeans', price: 79.00, image: 'https://placehold.co/400x400/334155/ffffff?text=Slim+Jeans', description: 'Modern fit denim, maximum flexibility.' },
            { id: 'p004', name: 'Wool Knit Beanie', price: 19.99, image: 'https://placehold.co/400x400/64748b/ffffff?text=Wool+Beanie', description: 'Perfect accessory for cold weather.' }
        ];

        // --- GLOBAL STATE ---
        let cart = JSON.parse(localStorage.getItem('shopmaster_cart')) || {};
        const CLIENT_ACCOUNTS_KEY = 'clientAccounts';
        const CLIENT_SESSION_KEY = 'clientLoggedIn';

        let clientAccounts = JSON.parse(localStorage.getItem(CLIENT_ACCOUNTS_KEY)) || {};
        let loggedInUser = localStorage.getItem(CLIENT_SESSION_KEY);


        // --- CORE FUNCTIONS ---
        function initApp() {
            renderProducts();
            updateCartUI();
            updateClientAuthUI();
        }

        function saveCart() {
            localStorage.setItem('shopmaster_cart', JSON.stringify(cart));
        }

        function updateClientAuthUI() {
            loggedInUser = localStorage.getItem(CLIENT_SESSION_KEY);
            const authButtons = document.getElementById('auth-buttons');
            const userInfo = document.getElementById('user-info');
            const userEmailDisplay = document.getElementById('user-display-email');

            if (loggedInUser) {
                authButtons.classList.add('hidden');
                userInfo.classList.remove('hidden');
                userEmailDisplay.textContent = loggedInUser.split(':')[0]; // Display the email part
            } else {
                authButtons.classList.remove('hidden');
                userInfo.classList.add('hidden');
            }
        }
        
        function updateCartUI() {
            const totalCount = Object.values(cart).reduce((sum, item) => sum + item.quantity, 0);
            const badge = document.getElementById('cart-count');
            badge.textContent = totalCount;

            // Animate badge
            if (totalCount > 0) {
                badge.classList.remove('scale-0');
                badge.classList.add('scale-100');
            } else {
                badge.classList.add('scale-0');
                badge.classList.remove('scale-100');
            }
            renderCartModalItems();
        }

        function renderProducts() {
            const container = document.getElementById('product-showcase');
            container.innerHTML = MOCK_PRODUCTS.map(product => `
                <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden group border border-gray-100">
                    <div class="relative h-64 overflow-hidden bg-gray-100">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover transform group-hover:scale-105 transition duration-500">
                        <button onclick="addToCart('${product.id}')" class="absolute bottom-4 right-4 bg-white text-gray-900 p-3 rounded-full shadow-lg hover:bg-blue-600 hover:text-white transition group-hover:opacity-100 opacity-80">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
                        </button>
                    </div>
                    <div class="p-5">
                        <h3 class="text-xl font-bold text-gray-900 mb-1">${product.name}</h3>
                        <p class="text-sm text-gray-500 mb-3">${product.description}</p>
                        <p class="text-blue-600 text-2xl font-extrabold">$${product.price.toFixed(2)}</p>
                    </div>
                </div>
            `).join('');
        }

        function renderCartModalItems() {
            const container = document.getElementById('cart-items-container');
            const totalEl = document.getElementById('cart-total');
            const checkoutBtn = document.getElementById('checkout-button');
            container.innerHTML = '';
            let grandTotal = 0;
            const cartItemsArray = Object.values(cart);

            if (cartItemsArray.length === 0) {
                container.innerHTML = '<li class="py-12 text-center text-gray-500 text-lg font-medium">Your cart is empty.<br>Start shopping!</li>';
                checkoutBtn.disabled = true;
                checkoutBtn.textContent = 'Checkout';
            } else {
                checkoutBtn.disabled = false;
                cartItemsArray.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    grandTotal += itemTotal;
                    const li = `
                        <li class="flex py-6">
                            <img src="${item.image}" alt="${item.name}" class="h-24 w-24 flex-shrink-0 rounded-md border border-gray-200 object-cover object-center">
                            <div class="ml-4 flex flex-1 flex-col">
                                <div>
                                    <div class="flex justify-between text-base font-medium text-gray-900">
                                        <h3><a href="#">${item.name}</a></h3>
                                        <p class="ml-4">$${itemTotal.toFixed(2)}</p>
                                    </div>
                                    <p class="mt-1 text-sm text-gray-500">$${item.price.toFixed(2)} each</p>
                                </div>
                                <div class="flex flex-1 items-end justify-between text-sm">
                                    <div class="flex items-center space-x-2">
                                        <p class="text-gray-500">Qty:</p>
                                        <button onclick="changeQuantity('${item.id}', -1)" class="text-gray-500 hover:text-gray-800 disabled:opacity-50" ${item.quantity <= 1 ? 'disabled' : ''}>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 12H6" /></svg>
                                        </button>
                                        <span class="font-medium">${item.quantity}</span>
                                        <button onclick="changeQuantity('${item.id}', 1)" class="text-gray-500 hover:text-gray-800">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
                                        </button>
                                    </div>
                                    <button type="button" onclick="removeItem('${item.id}')" class="font-medium text-red-600 hover:text-red-500">Remove</button>
                                </div>
                            </div>
                        </li>
                    `;
                    container.insertAdjacentHTML('beforeend', li);
                });
            }
            totalEl.textContent = `$${grandTotal.toFixed(2)}`;
        }

        // --- USER ACTIONS ---

        window.toggleCartModal = () => {
            const modal = document.getElementById('cart-modal');
            const panel = document.getElementById('cart-panel');
            const backdrop = document.getElementById('cart-backdrop');

            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                // Force reflow for transition
                requestAnimationFrame(() => {
                    panel.classList.remove('translate-x-full');
                    backdrop.classList.remove('opacity-0');
                    backdrop.classList.add('opacity-100');
                });
            } else {
                panel.classList.add('translate-x-full');
                backdrop.classList.remove('opacity-100');
                backdrop.classList.add('opacity-0');
                // Hide modal after transition completes
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300); // Must match CSS transition duration
            }
        };

        window.addToCart = (productId) => {
            const product = MOCK_PRODUCTS.find(p => p.id === productId);
            if (!product) return;

            if (cart[productId]) {
                cart[productId].quantity += 1;
            } else {
                cart[productId] = { ...product, quantity: 1 };
            }

            saveCart();
            updateCartUI();
        };

        window.changeQuantity = (productId, delta) => {
            if (cart[productId]) {
                cart[productId].quantity += delta;
                if (cart[productId].quantity <= 0) {
                    delete cart[productId];
                }
            }
            saveCart();
            updateCartUI();
        };

        window.removeItem = (productId) => {
            if (cart[productId]) {
                delete cart[productId];
            }
            saveCart();
            updateCartUI();
        };

        window.processCheckout = () => {
            if (!loggedInUser) {
                alert("You must be logged in to checkout! Please log in or register.");
                toggleCartModal(); // Close cart
                openAuthModal('login'); // Open login modal
                return;
            }

            const checkoutBtn = document.getElementById('checkout-button');
            checkoutBtn.textContent = 'Processing...';
            checkoutBtn.disabled = true;

            setTimeout(() => {
                alert(`Order Total: ${document.getElementById('cart-total').textContent}\n\nThank you for shopping, ${loggedInUser.split(':')[0]}! (Cart has been cleared)`);
                
                // Clear the cart after "checkout"
                cart = {};
                saveCart();
                updateCartUI();
                toggleCartModal();
                
                checkoutBtn.textContent = 'Checkout';
                checkoutBtn.disabled = false;
            }, 1500);
        };

        // --- AUTH MODAL LOGIC ---

        function showClientLogin() {
            document.getElementById('client-register-form').classList.add('hidden');
            document.getElementById('client-login-form').classList.remove('hidden');
            document.getElementById('c-login-error').classList.add('hidden');
            document.getElementById('c-register-error').classList.add('hidden');
        }

        function showClientRegister() {
            document.getElementById('client-login-form').classList.add('hidden');
            document.getElementById('client-register-form').classList.remove('hidden');
            document.getElementById('c-login-error').classList.add('hidden');
            document.getElementById('c-register-error').classList.add('hidden');
        }

        window.openAuthModal = (mode = 'login') => {
            document.getElementById('auth-modal').classList.remove('hidden');
            if (mode === 'register') {
                showClientRegister();
            } else {
                showClientLogin();
            }
        };

        window.closeAuthModal = () => {
            document.getElementById('auth-modal').classList.add('hidden');
        };

        // --- VALIDATION FUNCTIONS (Repeated for client, using window scope) ---
        function validateEmail(email) {
            if (!email) return "Email is required.";
            if (!email.endsWith("@gmail.com")) return "Email must end with '@gmail.com'.";
            return null;
        }

        function validatePassword(password) {
            if (!password) return "Password is required.";
            if (password.length < 8 || password.length > 10) return "Password must be 8 to 10 characters long.";
            // Requires: 1 capital, 1 small, 1 number, 1 symbol
            const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+])[A-Za-z\d!@#$%^&*()_+]{8,10}$/;
            if (!regex.test(password)) return "Password must contain a capital letter, a small letter, a number, and a symbol.";
            return null;
        }

        function validatePhone(phone) {
            if (!phone) return "Phone number is required.";
            if (!/^\d+$/.test(phone)) return "Phone number must contain only digits.";
            return null;
        }


        // --- CLIENT AUTH ---
        window.clientRegister = () => {
            const email = document.getElementById('c-reg-email').value.trim();
            const password = document.getElementById('c-reg-password').value;
            const phone = document.getElementById('c-reg-phone').value.trim();
            const errorEl = document.getElementById('c-register-error');
            errorEl.classList.add('hidden');
            errorEl.textContent = '';

            const emailError = validateEmail(email);
            if (emailError) { errorEl.textContent = emailError; errorEl.classList.remove('hidden'); return; }

            const passwordError = validatePassword(password);
            if (passwordError) { errorEl.textContent = passwordError; errorEl.classList.remove('hidden'); return; }

            const phoneError = validatePhone(phone);
            if (phoneError) { errorEl.textContent = phoneError; errorEl.classList.remove('hidden'); return; }

            if (clientAccounts[email]) {
                 errorEl.textContent = "An account with this email already exists. Please log in."; 
                 errorEl.classList.remove('hidden'); 
                 return; 
            }

            clientAccounts[email] = { password, phone };
            localStorage.setItem(CLIENT_ACCOUNTS_KEY, JSON.stringify(clientAccounts));
            alert('Registration successful! You can now log in.');
            showClientLogin();
        };

        window.clientLogin = () => {
            const email = document.getElementById('c-login-email').value.trim();
            const password = document.getElementById('c-login-password').value;
            const errorEl = document.getElementById('c-login-error');
            errorEl.classList.add('hidden');
            errorEl.textContent = '';

            if (!email || !password) {
                errorEl.textContent = "All fields are required.";
                errorEl.classList.remove('hidden');
                return;
            }

            const account = clientAccounts[email];

            if (account && account.password === password) {
                localStorage.setItem(CLIENT_SESSION_KEY, `${email}:${account.phone}`); // Store session info
                closeAuthModal();
                updateClientAuthUI();
            } else {
                errorEl.textContent = "Invalid email or password.";
                errorEl.classList.remove('hidden');
            }
        };

        window.clientLogout = () => {
            localStorage.removeItem(CLIENT_SESSION_KEY);
            updateClientAuthUI();
        };

    </script>
</body>
</html>